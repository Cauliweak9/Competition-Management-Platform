<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>login</title>
    <script src = "static/js/vue2.js"></script>
    <script src = "static/js/axios.min.js"></script>
    <link rel="stylesheet" href="static/template/top_navigation_bar.css">
    <link rel="stylesheet" href="static/css/login.css">
</head>
<body>
    <iframe class="fixed-top" src="static/template/top_navigation_bar.html" width="100%" height="62px" ></iframe>
    <br>
    <div class="login-container" id="app">
        <div class = "login-title">
            <img src="static/images/shark.png" alt="" id="logo">
            <span v-show="!islogged">登录到本科生竞赛交流平台</span>
            <span v-show="islogged" v-text="'欢迎回来，'+info.id"></span>
            <button id="back_to_index" v-show="islogged">返回首页</button>
        </div>
        <form action="/login" method = "post" @submit.prevent="loginform" v-show="!islogged">
            <div class="form-group">
                <label for="email" v-if="email" >请输入邮箱</label>
                <input type="email" id = "email" name = "email" @focus="onfocus('email')" @blur="onblur('email')" v-model="info.email"  >
            </div>
            <div class = "form-group">
                <label for="password" v-if="password">请输入密码</label>
                <input type= "password" id = "password" name = "password" @focus="onfocus('password')" @blur="onblur('password')" v-model="info.password">
            </div>
            <button type = "submit" class="btn-login" @click="loginform">登录</button>
        </form>
        <div class = "links" v-show="!islogged">
            <p id="signin">用户注册</p>
            <p id="forget_password">忘记密码</p>
        </div>
    </div>

<script>
  var app = new Vue({
      el:'#app',
      data: {
          email: true,
          password: true,
          islogged:false,
          input_email:"",
          input_password:"",
          info:{
              email:'',
              password:'',
              id:''
          }
      },
      methods:{
          onfocus(id){
              if(id === "email"){
                  this.email = false;
              }
              else if(id === "password"){
                  this.password = false;
              }
          },
          onblur(id){
              if(id === "email"){
                  this.email = this.info.email==="";
              }
              else if(id === "password"){
                  this.password = this.info.password==="";
              }
          },
          loginform: function(event) {
              that = this;
              event.preventDefault();
              let datadict = this.info;
         axios({
            method: 'post',
            url: '/login',
            data: {
                email: datadict.email,
                password: datadict.password
            },
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(function(res) {
            if(res.data.code === 1){
                that.islogged = true;
                that.info.email = res.data.data.email;
                that.info.id = res.data.data.id;
                that.info.password = res.data.data.password;
            }
            else if(res.code === 0){
                alert("用户名或密码错误");
            }
        }).catch(function(err) {
            alert("用户名或密码错误");
            document.getElementById('password').value = '';
        });
      }
  }
  })
</script>
</body>
</html>